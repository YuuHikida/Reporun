@model 業務報告システム.ViewModels.AdminIndex;

@{
    ViewData["Title"] = "Index";
}

@if (User.IsInRole("Admin"))
{
    <a class="btn btn-primary" asp-controller="Projects" asp-action="Index">プロジェクト管理</a>

}

@if (TempData["AlertUser"] != null)
{
    <div class="alert alert-success alert-dismissable fade show m-1" role="alert">
        @TempData["AlertUser"]
        <button class="btn-close" type="button" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["AlertUserError"] != null)
{
    <div class="alert alert-danger alert-dismissable fade show m-1" role="alert">
        @TempData["AlertUserError"]
        <button class="btn-close" type="button" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<h1>メンバーリスト</h1>

<a class="btn btn-primary" asp-area="Identity" asp-page="/Account/Register">ユーザー作成</a>

<p>ユーザー一覧</p>

@foreach (var user in Model.Users)
{

        <p>名前：@user.LastName @user.FirstName</p>
        <p>メールアドレス：@user.Email</p>
        <p>ロール：@user.Role</p>
    <p>参加中プロジェクト</p>
    @if (Model.UserProjects != null)
    {
        @foreach (var up in Model.UserProjects)
        {
            @if (up.UserId.Equals(user.Id))
            {
                @foreach (var pj in Model.Projects)
                {
                    @if (up.ProjectId == pj.ProjectId)
                    {
                        <p>@pj.Name</p>
                    }
                }

            }

        }

    }
    else
    {
        <p>参加中プロジェクトはありません</p>
    }

    @if (!(user.Role.Equals("Admin")))
    {
        <a asp-controller="Home" asp-action="Edit" asp-route-id="@user.Id" class="btn btn-primary">編集</a>
    }

        <form asp-action="Delete" onSubmit="return check()">
            <input type="hidden" name="id" value="@user.Id" />
            <input type="submit" value="削除" class="btn btn-danger" />
        </form>
        <p>---------------------</p>
    
}

<script>
    function check() {
        if (window.confirm('このユーザーを削除しますか？')) {
            return true;
        } else {
            return false;
        }
    }

</script>